
parameters:
  projectName: ''
  BuildConfiguration: ''
  deploy: ''
  PreProdSpecificVariableGroup: ''

stages:
  - stage: Build
    displayName: Build Stage
    jobs:
      - template: ../job/code-build.yml
        parameters:
          BuildConfiguration: $(BuildConfiguration)
          projectsToBuild: |
            src/$(projectName)/*.csproj

  - stage: Deploy_TEST
    dependsOn: Build
    displayName: Deploy to TEST
    variables:
      - group: "TEST DevTest Shared Resources"
      - group: "TEST Automation Suite Variables"
    jobs:
      - template: ../job/code-build.yml
        parameters:
          Environment: TEST
          ServiceConnection: SFA-DAS-DevTest-ARM
          projectName: $(projectName)

  - stage: Deploy_TEST2
    dependsOn: Build
    displayName: Deploy to TEST2
    variables:
      - group: "TEST2 DevTest Shared Resources"
      - group: "TEST2 Automation Suite Variables"
    jobs:
      - template: ../job/code-build.yml
        parameters:
          Environment: TEST2
          ServiceConnection: SFA-DAS-DevTest-ARM
          projectName: $(projectName)

  - stage: Deploy_DEMO
    dependsOn: Build
    displayName: Deploy to DEMO
    variables:
      - group: "DEMO DevTest Shared Resources"
      - group: "DEMO Automation Suite Variables"
    jobs:
      - template: ../job/code-build.yml
        parameters:
          Environment: DEMO
          ServiceConnection: SFA-DAS-DevTest-ARM
          projectName: $(projectName)

  - stage: Deploy_PP
    dependsOn: Build
    displayName: Deploy to PP
    variables:
      - group: "PreProd Management Resources"
      - group: "PreProd Shared Resources"
      - group: "PreProd Automation Suite Variables"
      - group: ${{ parameters.PreProdSpecificVariableGroup }}
    jobs:
      - template: ../job/code-build.yml
        parameters:
          Environment: PP
          ServiceConnection: SFA-DIG-PreProd-ARM
          projectName: $(projectName)